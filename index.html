<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DINO-DLL: HL2-DINO-DLL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-paragraph-link.js" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/HL2-DINO/DINO-DLL" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
  <svg viewBox="0 0 250 250" width="85" height="85" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="doc_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">DINO-DLL
   </div>
   <div id="projectbrief">C++ DLL for IR Tracking with HoloLens 2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">HL2-DINO-DLL </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__doxy_main_page"></a> </p><div class="image">
<img src="dll_logo_light.png" alt=""/>
</div>
    <div style="text-align:center;"> <h2>HoloLens 2 &amp; <ins>D</ins>etecting <ins>I</ins>nfrared markers for <ins>N</ins>avigation on <ins>O</ins>ST AR headsets</h2>
</div><div style="text-align:center;"> <em>by: Hisham Iqbal <a href="https://github.com/hiqb217">(hiqb217)</a></em> <img src="https://github.com/hiqb217.png?" alt="" height="30px;" class="inline"/> <div style="display: align-items: center;"> </div> </div><hr  />
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This is the C++ DLL used for the image-processing and tool-pose estimation used by the system reported in our publication: <a href="https://ieeexplore.ieee.org/document/9982215">Semi-Automatic Infrared Calibration for Augmented Reality Systems in Surgery</a><sup>[1]</sup> by Hisham Iqbal &amp; Ferdinando Rodriguez y Baena.</p>
<p>This project is a Windows Runtime Component (C++/WinRT)<sup>[2]</sup> DLL designed to enable the HoloLens 2 to detect the presence of tools equipped with IR-reflective markers. The resulting <code>.dll</code> and <code>.winmd</code> files can be copied and easily consumed on a C# Unity app (see <a href="https://github.com/HL2-DINO/DINO-Unity"><code>HL2-DINO-Unity</code></a> for example).</p>
<p>The classes in this project are designed to carry out the following tasks:</p>
<ol type="1">
<li>Grabbing sensor data from the HoloLens 2's AHAT depth sensor</li>
<li>Image processing to locate the presence of IR-reflective markers visible to the headset</li>
<li>Providing an interface for the C# Unity application to receive sensor images, tool pose data etc.</li>
</ol>
<div class="image">
<img src="outputGifLabelled.gif" alt=""/>
</div>
    <h1><a class="anchor" id="autotoc_md2"></a>
3rd Party Dependencies</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Libraries/Headers   </th><th class="markdownTableHeadNone">Note    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ResearchModeAPI.h</code>   </td><td class="markdownTableBodyNone">From the <a href="https://github.com/microsoft/HoloLens2ForCV/tree/main/Samples/ResearchModeApi">HoloLens2ForCV</a> project on GitHub    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OpenCV 4.5.3</code>   </td><td class="markdownTableBodyNone">Compiled for compatibility with UWP applications<sup>[3]</sup>. Static libraries included within this project    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Eigen</code>   </td><td class="markdownTableBodyNone">Header-only matrix library with no extra compilation required    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Shiny-UWP</code>   </td><td class="markdownTableBodyNone">Used for gathering profiler data<sup>[4]</sup>. Static libraries included.   </td></tr>
</table>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b> Shiny-UWP is optional and can be removed altogether if you are not interested in this info. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md3"></a>
Getting Started</h1>
<ol type="1">
<li><code>git clone <a href="https://github.com/HL2-DINO/DINO-DLL.git">https://github.com/HL2-DINO/DINO-DLL.git</a></code></li>
<li>Open <code>HL2DinoPlugin.sln</code>, set project configs to <code>Release</code> and <code>ARM64</code></li>
<li><em>[Optional] Make any changes to the source code as you wish</em></li>
<li>From Visual Studio menus, <code>[Build] -&gt; [Build Solution]</code></li>
<li>Copy generated <code>.dll</code> and <code>.winmd</code> from the <code>ARM64/Release/HL2DinoPlugin/</code> folder into your Unity project inside the folder <code>Assets/Plugins/WSA</code></li>
</ol>
<p>To see how to set up a sample Unity project, check out the <a href="https://github.com/HL2-DINO/DINO-Unity"><code>DINO-Unity</code></a> repositories.</p>
<p>You can use this project as is to build a <code>.dll</code> and <code>.winmd</code> in your Unity project. If you wish to make alterations to the source code to insert your own algorithms, then make any necessary adjustments, <b>and compile for <code>Release</code> and <code>ARM64</code> architecture</b>.</p>
<p>Two outputs of this process (<code>HL2DinoPlugin.dll</code> &amp; <code>HL2DinoPlugin.winmd</code>) will be contained in <code>ARM64/Release/HL2DinoPlugin</code>. These need to be copied over to your Unity project structure inside the folder <code>Assets/Plugins/WSA</code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Acknowledgements</h1>
<ul>
<li>If this project is useful for your research or work, please considering citing the following publication: <div class="fragment"><div class="line">@inproceedings{Iqbal2022,</div>
<div class="line">author = {Hisham Iqbal and Ferdinando Rodriguez y Baena},</div>
<div class="line">journal = {2022 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS 2022)},</div>
<div class="line">title = {Semi-Automatic Infrared Calibration for Augmented Reality Systems in Surgery},</div>
<div class="line">year = {2022},</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Thanks go out to:<ul>
<li>Prof Ferdinando Rodriguez y Baena - For project supervision, endless advice, and for guidance with the point-matching algorithms used in the project.</li>
<li><a href="https://github.com/andreaskeller96">Andreas Keller</a> - For providing crucial help with proper compilation and linking of the OpenCV libraries used in this project. See Andreas's excellent <a href="https://github.com/andreaskeller96/HoloLens2-IRTracking">HoloLens2-IRTracking</a> project for an alternative setup which achieves similar goals.</li>
<li>Arjun Muhunthan - For the many impromptu code-reviews I requested and for being a great source of C++ wisdom.</li>
<li>Dr Stefano Galvan - For his patience and time to provide best practices for software and algorithmic design as well as valuable insights into open-sourcing software.</li>
</ul>
</li>
<li>The design of the DLL in this project was based on some very useful open-source projects which are really worth exploring for your own research:<ol type="1">
<li><a href="https://github.com/petergu684/HoloLens2-ResearchMode-Unity">HoloLens2-ResearchMode-Unity</a> originally made available by <a href="https://github.com/petergu684/">petergu684</a>.</li>
<li><a href="https://github.com/microsoft/HoloLens2ForCV">HoloLens2ForCV</a> originally made available by Microsoft.</li>
</ol>
</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note</b>: <a href="https://www.flaticon.com/free-icons/settings">Gear Icon in repository logo created by Freepik - Flaticon</a> </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md5"></a>
Appendix</h1>
<h2>Additional Notes </h2>
<p>There are some additional features which have not been implemented yet to expedite the process of open-sourcing.</p>
<p>TO-DO's on the DLL side:</p>
<p>🔲 Move away from detecting contours every single frame</p>
<p>In this version, blob/contour detection runs every frame, which is the most time consuming part of the image processing loop. By using tracking algorithms to lower the frequency of detection, we could potentially get some performance gain.</p>
<p>🔲 Integrate filtering into the processing of the noisy sensor data.</p>
<p>Noise in the sensor data (infrared response / computed depth) results in noisy estimates for tool pose. This could be tackled with simple low-pass filters added to each TrackedTool struct, or an implementation of Kalman filters incorporating data from other streams of the HoloLens (visual light environmental cameras, IMU data).</p>
<p>🔲 Adding support to process data in millimetres and metres.</p>
<p>The internal processing and exposed outputs of pose estimation is done entirely with metres. With some small scaffolding in the code, we can support doing this in millimetres. At present, you can pass in tool config data as millimetres, but it's converted into metres before it reaches the DLL.</p>
<h2>License </h2>
<p>This project is licensed under the <a class="el" href="md__l_i_c_e_n_s_e.html">BSD License</a>.</p>
<h2>Other Build Information </h2>
<ul>
<li>The project was originally built to target Windows 10 SDK, version 2004 (10.0.19041.0).</li>
<li>This project has been tested and built with VS 2019 &amp; VS 2022, with Universal Windows Platform development tools installed.</li>
</ul>
<hr  />
<h2>References </h2>
<p>[1]: Iqbal H., Rodriguez y Baena, F. (2022) Semi‑Automatic Calibration for Augmented Reality Systems in Surgery. 2022 IEEE/RSJ International Conference on Intelligent Robots and Systems <a href="https://dx.doi.org/10.1109/IROS47612.2022.9982215">https://dx.doi.org/10.1109/IROS47612.2022.9982215</a></p>
<p>[2]: The project was built using a Windows Runtime Component (C++/WinRT) project template on Visual Studio 2019. See <a href="https://learn.microsoft.com/en-us/windows/uwp/winrt-components/create-a-windows-runtime-component-in-cppwinrt">this tutorial</a> for a reference on how to set up your own project.</p>
<p>[3]: If you want to re-compile OpenCV with different flags or for a different major version, it is highly recommended you follow the instructions found in this project <a href="https://github.com/andreaskeller96/HoloLens2-IRTracking/blob/main/OpenCV/README.md">README</a> written by Andreas Keller. Some more reading on the topic can be done <a href="https://medium.com/@rabbi.cse.sust.bd/how-to-build-opencv-for-universal-windows-platform-uwp-1a642ec09955">here</a> and <a href="https://github.com/doughtmw/NuGet-Package-Creation">here</a></p>
<p>[4]: A <a href="https://github.com/hiqb217/shinyprofiler-uwp">forked repository</a> of the original <a href="https://github.com/aidinabedi/shinyprofiler">Shiny Profiler</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
